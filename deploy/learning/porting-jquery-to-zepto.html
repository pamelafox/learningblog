<!doctype html>
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en" xmlns:fb="http://www.facebook.com/2008/fbml"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="">
  <title>Porting from jQuery to Zepto</title>
  <meta name="description" content="">
  <meta name="author" content="Pamela Fox">
  <meta name="viewport" content="">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link href="http://fonts.googleapis.com/css?family=Didact Gothic&subset=latin" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/media/css/all-blog-min.css">
  <link rel="stylesheet" href="/media/css/syntax.css">
  <style>
  pre code {
    background-color: transparent;
  }
  code {
    background-color: transparent;
    font-weight: bold;
  }
  .post img {
    border: 1px solid #ccc;
  }
  </style>
        </head>
<body id="porting-jquery-to-zepto">

  
    
    <!-- Header -->
    <div id="header" class="topbar">
      <div class="topbar-inner">
          <div class="container">
           <h3>
              <a href="/learning" style="padding-right: 5px">
                <div class="logo" style="width: 112px; height: 40px; margin-right: 0px; background-repeat: no-repeat; background-image:url('/media/img/everydaylogo_trans.png')"></div>

              </a>
              <span style="color:white"> ...I'm learning.</span>
            </h3>
                      </div>
      </div>
    </div>
    <!-- /Header -->

    <!-- Main -->
    <div class="container"> 
      <div class="row">
       <div class="span11 columns">
        <article class="post">
    <div class="page-header">
        <h1 class="title">
            <a href="/learning/porting-jquery-to-zepto.html">
                Porting from jQuery to Zepto
            </a>
        </h1>
        

        <time datetime="2011-11-19">
            Saturday, November 19, 2011
        </time>

        <div style="float:right">
            <a href="http://twitter.com/share"
                class="twitter-share-button"
                data-count="horizontal" 
                data-via="ringce">Tweet</a>
                <script type="text/javascript"
                    src="http://platform.twitter.com/widgets.js"></script>
            <!-- Place this tag where you want the +1 button to render -->
            <g:plusone size="small"></g:plusone>

            <!-- Place this render call where appropriate -->
            <script type="text/javascript">
              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
            </script>
        </div>

        <div style="clear:right"></div>

    </div>
    
    <p>In my quest for better performance in my PhoneGap Android app, I finally decided to switch from using jQuery to <a href="http://zeptojs.com/">Zepto</a>,
a framework that boasts a similar <span class="caps">API</span> with a much smaller footprint and additionally offers mobile specific touch events.
Of course, since Zepto is designed to be lighter weight than jQuery, it does not offer all the same methods &mdash; and the methods
that it does offer sometimes differ in their arguments. This makes sense but it means that porting from jQuery
to Zepto requires learning how their differences affect your code, and how you can workaround&nbsp;them.
</p>

<p>Since other developers might start going down the porting path too, I thought I&#8217;d write a post on the differences I encountered while porting.
Because I reuse much of my application code between my Phonegap app and desktop web app and I&#8217;m not yet ready to eliminate jQuery
in my desktop app, I wanted to port my code over in a way that would mean it would work with either jQuery or Zepto as a base framework.
That effectively meant that I tried to keep my code the same, and simply add to the Zepto <span class="caps">JS</span> file where needed. 
I&#8217;ll explain my ports below and then show my Zepto additions at the&nbsp;end.
</p>

<p>This post got a bit long, so here are quick links to the&nbsp;sections:</p>

<ul>
 <li><a href="#core">Porting core functionality</a>
 <li><a href="#plugins">Porting plugins</a>
 <li><a href="#summary">Summary: What&#8217;s different</a>
 <li><a href="#zeptogist">My Zepto modifications</a>
 <li><a href="#perf">Performance comparison</a>
 <li><a href="#conclusion">Conclusion: Was it worth it?</a>
</ul>

<div class="page-header">
<h3 id="core">Porting core&nbsp;functionality</h3>
</div>

<p>I spent most of my time porting 3rd party jQuery plugin code, as they tend to use the more esoteric jQuery features, but I also found a few places
in my own application code where I was using jQuery functionality that&#8217;s missing from&nbsp;Zepto:</p>
<ul>
 <li><b><span class="caps">CORS</span></b>:
  <p>I use <span class="caps">CORS</span> (cross-domain XMLHttpRequests) to communicate from my mobile app to my server, and that means setting <code>xhrFields</code> in <a href="http://api.jquery.com/jQuery.ajax/">jQuery.ajax()</a>,
 something that isn&#8217;t yet supported in Zepto. Luckily, there&#8217;s <a href="https://github.com/madrobby/zepto/pull/313">a patch</a> for it, and I applied that. 
 I also discovered <a href="https://github.com/madrobby/zepto/issues/319">a bug</a> with sending empty strings in <span class="caps">CORS</span> requests, and I work around that by sending <code>null</code> instead.
 </p>
 <li><b>scrollTop</b>:
  <p>I use <a href="http://api.jquery.com/scrolltop/">jQuery.scrollTop()</a> to reset the scroll in my mobile app on page transition, so I took and Zepto-ified the jQuery&nbsp;implementation.</p>

<p><li><b>position</b>:
  <p>I use <a href="http://api.jquery.com/position/">jQuery.position()</a> to calculate where to scroll to in some cases, and Zepto only supports <code>offset()</code>. I checked out the jQuery source code for calculating position and stuck that inside&nbsp;Zepto.</p></p>
<p><li><b>non-standard selectors</b>: 
  <p>jQuery supports several convenience selectors that aren&#8217;t defined in the w3 spec and simply special cases them in their code, and these won&#8217;t work as selectors in Zepto. There are some that correspond to methods - <code>":first"</code> is <code>.first()</code> in Zepto, and <code>":last"</code> is <code>last()</code>. There are others with no equivalents, like <code>":hidden"</code>, and <code>":visible"</code>, and I just removed my usage of them or checked display values manually. (I didn&#8217;t feel like checking the jQuery source for&nbsp;them.)
  </p></p>
<p><li><b>valueless attributes</b>:
  <p>There are times when I set and remove valueless attributes on form elements, like <code>"checked"</code>, <code>"readonly"</code>, and <code>"disabled"</code>. In jQuery, I used <code>.attr('disabled', false)</code>. That&#8217;s apparently been replaced in jQuery 1.7 by <code>.prop('disabled', false)</code>. Neither will work in Zepto, however, but <code>removeAttr('disabled')</code> will. Since I want my code working with both, I now have <code>.attr('disabled', false).removeAttr('disabled')</code>, just to be&nbsp;sure.
  </p>
</ul></p>
<h3 id="plugins">Porting&nbsp;plugins</h3>

<p>I use five jQuery plugins in my mobile app, only one of which I wrote myself, and they took the longest to port. 
For all of these plugins, I started off by changing the final line in the file from <code>'})(window.jQuery);'</code> to  <code>'})(window.jQuery || window.Zepto);'</code> and then hoped for the&nbsp;best.
</p>
<ul>
 <li><b>ColorSlider</b>:
  <p>I wrote this plugin to give users a colorful slider (red to green), and the only jQuery function it was missing was <a href="http://api.jquery.com/outerwidth/">outerWidth()</a>, so I wrote one based on the jQuery implementation. In doing so, I discovered that the Zepto width() function includes the padding and border, which jQuery.width() doesn&#8217;t, so I submitted <a href="https://github.com/pamelafox/zepto/commit/5c8538e147a8263d1d0e3ce12d44a8a15d7f5457">a patch</a> clarifying that in the Zepto&nbsp;docs.
  </p>

<p><li><b><a href="http://api.jquery.com/category/plugins/templates/">jQuery Templates</a></b>:
 <p>I was pretty worried about this port, but then found out that the jQuery templates was being deprecated in favor of a non-jQuery dependent library, <a href="https://github.com/BorisMoore/jsrender">jsRender/jsViews</a>. That library is in beta and the docs are minimal, but the templating syntax is largely the same, and the author responded quickly to <a href="https://github.com/BorisMoore/jsrender/issues/25">my upgrade question</a>. One thing to note, though: the jsViews library tries to take the global <code>$</code> variable if it doesn&#8217;t see jQuery defined, so you have to call <code>$.noConflict()</code> after loading it if you want to use <code>$</code> with Zepto instead &mdash; but you don&#8217;t want to call that if you are actually using jQuery. Here&#8217;s what I have after I load my scripts: <code>if (window.Zepto) $.noConflict();</code>
 </p></p>
<p><li><b><a href="http://timeago.yarp.com/">timeago</a></b>:
 <p>This handy library turns timestamps into pretty times like &#8220;1 day ago&#8221; and also auto refreshes elements with timestamps on an interval. It relies on <a href="http://api.jquery.com/jQuery.trim/">jQuery.trim</a>, which I just copied from their codebase. Along with the DateInput plugin, it relies on the ability to store objects as data attributes (instead of just strings), and thankfully, there&#8217;s a <a href="https://github.com/madrobby/zepto/blob/master/src/data.js">data.js</a> in the Zepto codebase that I copied into my Zepto <span class="caps">JS</span> to handle&nbsp;that. </p></p>
<p><li><b><a href="https://github.com/twitter/bootstrap/blob/master/js/bootstrap-modal.js">Twitter Bootstrap modal</a></b>: 
 <p>This is a simple modal library that&#8217;s designed to work with either jQuery or <a href="http://ender.no.de/">Ender</a>(a lightweight package library), so it already relied on minimal jQuery features. It does attach functions to <a href="http://api.jquery.com/jQuery.support/">$.support</a>, which Zepto doesn&#8217;t define, so I added a one-liner to define it. It also uses <a href="http://api.jquery.com/jQuery.proxy/">$.proxy</a>, which I copied from the jQuery&nbsp;codebase.</p></p>
<p><li><b><a href="http://flowplayer.org/tools/dateinput/">jQuery Tools DateInput</a></b>:
 <p>This was by far the hardest plugin to port, and I did look around briefly to see if I should just switch to a completely different pure <span class="caps">JS</span> datepicker library, but I quite like this one so I stuck with with it. First, it uses <code>$.expr</code>, a jQuery object that isn&#8217;t actually documented and (from what rumors tell me) might actually go away soon. I wasn&#8217;t actually using the results of that function, so I simply defined the object so that the code would not error out. It also uses <a href="http://api.jquery.com/clone/">jQuery.clone</a> and <a href="http://api.jquery.com/event.isDefaultPrevented/">Event.isDefaultPrevented</a>, which were simple enough to write my own versions&nbsp;of.</p><p>Now we get to the tricky parts - methods that exist in both frameworks but don&#8217;t have the
 same interface or behavior. I filed bugs on most of these, but the Zepto team could decide to keep their interface the same for simplicity:
 Zepto doesn&#8217;t handle multiple self-closing tags in a creation string the same way as jQuery (<a href="https://github.com/madrobby/zepto/issues/322">Issue 322</a>),  Zepto does not assign this to the current iterated object in <code>each()</code> (<a href="https://github.com/madrobby/zepto/issues/295#issuecomment-2801449">Issue 295</a>), and Zepto does not include an option for deep copy in the <code>extend()</code> function, and Zepto doesn&#8217;t handle non-<span class="caps">DOM</span> objects in expressions/events (<a href="https://github.com/madrobby/zepto/issues/321">Issue 321</a>, That last one unfortunately required a bit of dirty finagling in the DateInput code itself, as its non obvious how to extend Zepto to support binding and firing events on non-<span class="caps">DOM</span>&nbsp;objects.</p></p>
</ul>

<h3 id="summary">Summary: What&#8217;s&nbsp;different</h3>

<p>
To summarize, the following jQuery functionality is missing from Zepto (and much of it is in the gist below):
<ul>
 <li><code>scrollTop()</code>
 <li><code>position()</code>
 <li><code>":first"</code>, <code>":last"</code>, <code>":hidden"</code>, <code>":visible"</code>
 <li><code>prop()</code>
 <li><code>outerWidth()</code>
 <li><code>trim()</code>
 <li><code>support()</code>
 <li><code>proxy()</code>
 <li><code>expr()</code>
 <li><code>isDefaultPrevented()</code>
</ul>

<p>And this functionality differs in&nbsp;behavior/arguments:</p>
<ul>
 <li><code>attr('disabled', false);</code>
 <li><code>ajax() CORS</code>
 <li><code>width()</code>
 <li><code>data()</code>
 <li><code>each()</code>
 <li><code>extend()</code>
</ul>

<h3 id="zeptogist">My Zepto&nbsp;modifications</h3>

<p>Most of the above issues were resolved by defining functions or objects in Zepto, and this gist shows all of&nbsp;those:
</p>

<script src="https://gist.github.com/1379704.js?file=zepto-extras.js"></script>

<p>I also made a few tweaks to the core Zepto code, and you can see those in <a href="http://diffchecker.com/YhGN69g">this diff</a>
(but not all of them are necessarily successful tweaks, nor are they&nbsp;tested.)</p>

<h3 id="perf">Performance&nbsp;comparison</h3>

<p>Since my main point in porting over to Zepto was to improve my loading performance, I celebrated the successful porting by measuring the loading times for my page.
I used <a href="https://gist.github.com/1302665">this timing code</a> and compared the differences between including a minified jQuery 1.7 script tag and a minified Zepto script tag, both for a fresh app install and an app re-launch. On average, switching to Zepto shaved 22% off my total loading time. For the detailed results, check out <a href="https://docs.google.com/spreadsheet/ccc?key=0Aq_a4WNAMuCEdDdjSlhyWXJaTkQ0TVJFc1k1RzlTTlE#gid=0">this spreadsheet</a>.
</p>

<h3 id="conclusion">Was it worth&nbsp;it?</h3>

<p>I&#8217;m happy that I ported, but it&#8217;s not a decision to be taken lightly. jQuery alternatives are still in early stages, so if you use them, you have to think of yourself as a beta user, be prepared for issues, be prepared for lack of documentation, and do the responsible thing &mdash; report whatever issues or workarounds you find.
And on that note, thanks to the Zepto authors for bearing with my barrage of issues over the last few days.&nbsp;:)
</p>
        <ul class="tags pills">
        <li><a class="small" href="/blog/tags/phonegap.html">
            phonegap
    </a>
        <li><a class="small" href="/blog/tags/performance.html">
            performance
    </a>
        <li><a class="small" href="/blog/tags/jquery.html">
            jquery
    </a>
        <li><a class="small" href="/blog/tags/zepto.html">
            zepto
    </a>
        <li><a class="small" href="/blog/tags/android.html">
            android
    </a>
        </ul>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'everydayimlearning';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

</article>       </div>
       <div class="span5 columns">
          <div class="well" style="margin-top:20px">
            <img src="/media/img/profilepic.jpg" style="border: 1px solid #CCC; width: 90px; float: right; margin-left: 10px;">
            <p>
            Heyaz! I'm <a href="http://pamelafox.org">Pamela Fox</a>. A few months ago, I started working on <a href="http://everyday.io">everyday.io</a>,
            an app to help people change their eating habits for the better.
            </p>
            <p>
            I'm building it in Python with the Flask microframework, running it on 
            Google App Engine, and using PhoneGap to create Android and iPhone apps for it.
            I'm learning a lot along the way and using this blog to document what I learn.
            </p>
            <blockquote style="margin-top:35px">
             <p>The journey is the reward.</p>
             <small>Steve Jobs</small>
            </blockquote>
          </div>
        </div>
      </div>
     
    </div> 
    <!-- /Main -->

        
    <!-- Main -->
    <div id="footer"> 
      <div class="container">
        <p>Â© 2011 everyday.io. Powered by <a href="http://ringce.com/hyde">hyde</a>.
        </p>
      </div>
    </div>
    <!-- /Main -->

  
  
    <script src="/media/js/libs/zepto-min.js"></script>
  
      
<script>
$(document).ready(function() {
  function detectHash() {
    function maybeScrollToHash() {
      if (window.location.hash && $(window.location.hash).length) {
        var newTop = $(window.location.hash).offset().top - $('.topbar').height();
        $(window).scrollTop(newTop);
      }
    }

    $(window).bind('hashchange', function() {
      maybeScrollToHash();
    });

    maybeScrollToHash();
  }

  detectHash();
});
</script>

  </body>
</html>